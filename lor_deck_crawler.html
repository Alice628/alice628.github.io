<!DOCTYPE html>
<html lang="kr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOR deck crawler</title>
    <style>
        select {
            width: 40%;
            height: 50px;
        }

        button {
            width: 60%;
            height: 50px;
        }

        #list_container span {
            cursor: pointer;
        }

        #list_container span:hover {
            background-color: black !important;
            color: white !important;
        }

        /* The snackbar - position it at the bottom and in the middle of the screen */
        #snackbar {
            visibility: hidden;
            /* Hidden by default. Visible on click */
            min-width: 250px;
            /* Set a default minimum width */
            margin-left: -125px;
            /* Divide value of min-width by 2 */
            background-color: #333;
            /* Black background color */
            color: #fff;
            /* White text color */
            text-align: center;
            /* Centered text */
            border-radius: 2px;
            /* Rounded borders */
            padding: 16px;
            /* Padding */
            position: fixed;
            /* Sit on top of the screen */
            z-index: 1;
            /* Add a z-index if needed */
            left: 50%;
            /* Center the snackbar */
            bottom: 30px;
            /* 30px from the bottom */
        }

        /* Show the snackbar when clicking on a button (class added with JavaScript) */
        #snackbar.show {
            visibility: visible;
            /* Show the snackbar */
            /* Add animation: Take 0.5 seconds to fade in and out the snackbar.
  However, delay the fade out process for 2.5 seconds */
            -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        /* Animations to fade the snackbar in and out */
        @-webkit-keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }

            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @keyframes fadein {
            from {
                bottom: 0;
                opacity: 0;
            }

            to {
                bottom: 30px;
                opacity: 1;
            }
        }

        @-webkit-keyframes fadeout {
            from {
                bottom: 30px;
                opacity: 1;
            }

            to {
                bottom: 0;
                opacity: 0;
            }
        }

        @keyframes fadeout {
            from {
                bottom: 30px;
                opacity: 1;
            }

            to {
                bottom: 0;
                opacity: 0;
            }
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        let codeList;
        let snackbarTimeOut;
        function fn_lender() {
            fn_lenderList()
            fn_lenderSelect()
        }

        function fn_lenderList() {
            let listHTML = "";
            codeList.forEach(function (deck, index) {
                listHTML += '<p id="' + (index + 1) + '">'
                listHTML += '<span class="title">' + deck.title + '</span><br>'
                listHTML += '<span class="code">' + deck.code + '</span>'
                listHTML += '</p>'
            })
            $("#list_container").html(listHTML);
            $("#list_container > p > span").on("click", function () {
                fn_onClickText(this);
            })
        }

        function fn_lenderSelect() {
            let sltHTML = "";
            sltHTML += '<select id="slt_index">';
            for (let i = 1; i <= codeList.length; i++) {
                sltHTML += '<option value="' + i + '">' + i + '</option>'
            }
            sltHTML += '</select>';
            $("#slt_container").html(sltHTML);

            $("select").on("change", function () {
                fn_onChangeSelect();
            })
            fn_onChangeSelect();
        }

        function fn_copy() {
            let index = $("#slt_index").val();
            let type = $("#slt_type").val();

            fn_copyText(index, type);
            fn_showSnackbar(index, type);

            if (type == "code") {
                $("#slt_type").val("title").prop("selected", true);
            } else {
                $("#slt_index").val(Number(index) + 1).prop("selected", true);
                $("#slt_type").val("code").prop("selected", true);
            }
            fn_onChangeSelect();
        }

        function fn_copyText(index, type) {
            var obj = $("#" + index + " > " + "." + type)[0];
            var range = document.createRange();
            range.selectNode(obj.childNodes[0]); //텍스트 정보를 Range 객체에 저장
            var sel = window.getSelection();
            sel.removeAllRanges(); //기존 선택정보 삭제
            sel.addRange(range); //텍스트 정보 선택
            document.execCommand("copy"); //복사
            sel.removeRange(range); //선택 정보 삭제
        }

        function fn_onChangeSelect() {
            let index = $("#slt_index").val();
            let type = $("#slt_type").val();
            var obj = $("#" + index + " > " + "." + type);

            $("#list_container > p > span").css("background-color", "white")
            $("#list_container > p > span").css("color", "black")

            obj.css("background-color", "black")
            obj.css("color", "white")
        }

        function fn_onClickText(element) {
            let obj = $(element)
            let type = obj.prop("class");
            let index = obj.parent().prop("id");

            $("#slt_index").val(Number(index)).prop("selected", true);
            $("#slt_type").val(type).prop("selected", true);
            fn_onChangeSelect();
            fn_copy();
        }

        function fn_showSnackbar(index, type) {
            let ordinal = "";
            switch (index) {
                case 1:
                    ordinal = "st";
                    break;
                case 2:
                    ordinal = "nd";
                    break;
                case 3:
                    ordinal = "rd";
                    break;
                default:
                    ordinal = "th"
                    break;
            }
            $("#snackbar").html(index + ordinal + " deck's " + type + " is copied!");

            // Get the snackbar DIV
            var x = document.getElementById("snackbar");

            // Add the "show" class to DIV
            x.className = "show";

            // After 3 seconds, remove the show class from DIV
            clearTimeout(snackbarTimeOut);
            snackbarTimeOut = setTimeout(function () { x.className = x.className.replace("show", ""); }, 3000);
        }

        $(function () {
            axios.get('https://lor.mobalytics.gg/api/v1/meta/tier-list', {
            })
                .then(function (response) {
                    let archetypes = response.data.archetypes
                    //console.log(archetypes);
                    let numStr = "";
                    codeList = new Array;
                    archetypes.forEach(function (element, index) {
                        let num = index + 1;
                        let code = {};
                        if (num < 10) {
                            numStr = "0" + num;
                        } else {
                            numStr = num + "";
                        }
                        code.title = numStr + "." + element.title;
                        code.code = element.mostPopularDeck.exportUID;

                        codeList.push(code);
                    });

                    fn_lender();
                })
                .catch(function (error) {
                    console.log(error);
                })
                .finally(function () {
                    // always executed
                });
        })
    </script>
</head>

<body>
    <p>
        <span id="slt_container"></span>
        <span>
            <select id="slt_type">
                <option value="code">
                    code
                </option>
                <option value="title">
                    title
                </option>
            </select>
        </span>
    </p>
    <button type="button" onclick="fn_copy()">copy</button>
    <div id="list_container">
    </div>

    <!-- The actual snackbar -->
    <div id="snackbar">Some text some message..</div>
</body>

</html>