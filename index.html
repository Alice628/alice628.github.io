<!DOCTYPE html>
<html lang="kr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index</title>
    <style>
        select {
            width: 40%;
            height: 50px;
        }

        button {
            width: 60%;
            height: 50px;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        let codeList;
        function lender() {
            lenderList()
            lenderSelect()
        }

        function lenderList() {
            let listHTML = "";
            codeList.forEach(function (deck, index) {
                listHTML += '<p id="' + (index + 1) + '">'
                listHTML += '<span class="title">' + deck.title + '</span><br>'
                listHTML += '<span class="code">' + deck.code + '</span>'
                listHTML += '</p>'
            })
            $("#list_container").html(listHTML);
        }

        function lenderSelect() {
            let sltHTML = "";
            sltHTML += '<select id="slt_index">';
            for (let i = 1; i <= codeList.length; i++) {
                sltHTML += '<option value="' + i + '">' + i + '</option>'
            }
            sltHTML += '</select>';
            $("#slt_container").html(sltHTML);
        }

        function copy() {
            let index = $("#slt_index").val();
            let type = $("#slt_type").val();

            copyText(index, type);

            if (type == "code") {
                $("#slt_type").val("title").prop("selected", true);
            } else {
                $("#slt_index").val(Number(index) + 1).prop("selected", true);
                $("#slt_type").val("code").prop("selected", true);
            }

        }

        function copyText(index, type) {
            var obj = $("#" + index + " > " + "." + type)[0];
            var range = document.createRange();
            range.selectNode(obj.childNodes[0]); //텍스트 정보를 Range 객체에 저장
            var sel = window.getSelection();
            sel.removeAllRanges(); //기존 선택정보 삭제
            sel.addRange(range); //텍스트 정보 선택
            document.execCommand("copy"); //복사
            sel.removeRange(range); //선택 정보 삭제
        }

        $(function () {
            axios.get('https://lor.mobalytics.gg/api/v1/meta/tier-list', {
            })
                .then(function (response) {
                    let archetypes = response.data.archetypes
                    //console.log(archetypes);
                    let numStr = "";
                    codeList = new Array;
                    archetypes.forEach(function (element, index) {
                        let num = index + 1;
                        let code = {};
                        if (num < 10) {
                            numStr = "0" + num;
                        } else {
                            numStr = num + "";
                        }
                        code.title = numStr + "." + element.title;
                        code.code = element.mostPopularDeck.exportUID;

                        codeList.push(code);
                    });

                    lender();
                })
                .catch(function (error) {
                    console.log(error);
                })
                .finally(function () {
                    // always executed
                });
        })
    </script>
</head>

<body>
    <p>
        <span id="slt_container"></span>
        <span>
            <select id="slt_type">
                <option value="code">
                    code
                </option>
                <option value="title">
                    title
                </option>
            </select>
        </span>
    </p>
    <button type="button" onclick="copy()">copy</button>
    <div id="list_container">
    </div>
</body>

</html>